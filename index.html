<!DOCTYPE html>
  <html lang="ru">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Сканер QR-кодов (ZXing)</title>
  </head>
  <body>
    <h1>Сканировать QR/штрихкод</h1>
    <video id="video" width="300" height="200" style="border:1px solid gray"></video>
    <p id="result"></p>
    <button id="start-btn">Старт</button>
    <button id="stop-btn">Стоп</button>
    <div id="result"></div>
    
    <script type="module">
      import { BrowserMultiFormatReader } from 'https://cdn.jsdelivr.net/npm/@zxing/browser@latest/+esm';
  
      let codeReader;
      let controls;
  
      document.getElementById('start-btn').onclick = async () => {
        const video = document.getElementById('video');
        const resultElem = document.getElementById('result');
        resultElem.textContent = 'Сканирование...';
  
        codeReader = new BrowserMultiFormatReader();
        try {
          controls = await codeReader.decodeFromVideoDevice(null, video, (result, err) => {
            if (result) {
              resultElem.textContent = 'Код: ' + result.text;
              controls.stop();
              fetch(`http://192.168.50.183:80/run-parsing-check?invoice_link=${encodeURIComponent(result.text)}`, {
                method: 'GET',
                // headers: {
                //     'invoice-link': encodeURIComponent(decodedText)
                // }
            })
            .then(response => {
                switch (response.status) {
                    case 200:
                        document.getElementById('result').innerHTML += `<div style="color:green;">Success</div>`;
                        break;
                    default:
                        document.getElementById('result').innerHTML += `<div style="color:red;">Failed</div>`;
                        break;
                }
                return response.text();
            })
            }
          });
        } catch (e) {
          resultElem.textContent = 'Ошибка: ' + e;
        }
      };
  
      document.getElementById('stop-btn').onclick = () => {
        if (controls) controls.stop();
        document.getElementById('result').textContent = 'Сканирование остановлено.';
      };
    </script>
  </body>
  </html>
  